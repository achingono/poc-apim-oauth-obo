Thank you for installing {{ .Chart.Name }}!

Your release is named {{ .Release.Name }}.

Environment: {{ .Values.environment }}
{{- if eq .Values.environment "Production" }}
Authentication: Azure Workload Identity (Federated Credentials)
{{- else }}
Authentication: Client Secret (Development Only)
{{- end }}

To learn more about the release, try:

  $ helm status {{ .Release.Name }} -n {{ .Release.Namespace }}
  $ helm get all {{ .Release.Name }} -n {{ .Release.Namespace }}

To check the status of your deployment:

  $ kubectl get pods -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "oauth-obo-client.name" . }}

To view the logs:

  $ kubectl logs -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "oauth-obo-client.name" . }}

{{- if .Values.ingress.enabled }}
{{- range .Values.ingress.hosts }}
To access the application:
{{- if .host }}
  URL: http{{ if $.Values.ingress.tls }}s{{ end }}://{{ .host }}{{ range .paths }}{{ .path }}{{ end }}
{{- if eq $.Values.environment "Development" }}

NOTE: For local development, add this to your /etc/hosts file:
  $(minikube ip) {{ .host }}
{{- end }}
{{- else }}
  URL: http{{ if $.Values.ingress.tls }}s{{ end }}://<external-ip>{{ range .paths }}{{ .path }}{{ end }}
  
  Get external IP with:
  $ kubectl get ingress {{ include "oauth-obo-client.fullname" $ }} -n {{ $.Release.Namespace }}
{{- end }}
{{- end }}
{{- else if .Values.service.enabled }}
To access the application:
{{- if contains "NodePort" .Values.service.type }}
  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "oauth-obo-client.fullname" . }})
  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.service.type }}
  NOTE: It may take a few minutes for the LoadBalancer IP to be available.
        You can watch the status by running 'kubectl get --namespace {{ .Release.Namespace }} svc -w {{ include "oauth-obo-client.fullname" . }}'
  export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "oauth-obo-client.fullname" . }} --template "{{"{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}"}}")
  echo http://$SERVICE_IP:{{ .Values.service.port }}
{{- else if contains "ClusterIP" .Values.service.type }}
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "oauth-obo-client.name" . }},app.kubernetes.io/instance={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace {{ .Release.Namespace }} $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 8080:$CONTAINER_PORT
{{- end }}
{{- end }}

Configuration:
- APIM Base URL: {{ .Values.apim.baseUrl }}
- Azure Tenant ID: {{ .Values.azure.tenantId }}
- Client ID: {{ .Values.azure.clientId }}
{{- if and .Values.workloadIdentity.enabled (eq .Values.environment "Production") }}
- Workload Identity Client ID: {{ .Values.workloadIdentity.clientId }}
{{- end }}

{{- if eq .Values.environment "Production" }}

IMPORTANT: For AKS deployment with Workload Identity:
1. Ensure your AKS cluster has OIDC issuer and workload identity enabled
2. Verify the federated credential is configured in Azure AD
3. The service account should be annotated with the managed identity client ID
4. Pod labels should include: azure.workload.identity/use: "true"

{{- else }}

IMPORTANT: For local/development deployment:
1. This deployment uses client secrets stored in Kubernetes secrets
2. This is NOT suitable for production use
3. Client secrets should be rotated regularly
4. Never commit secrets to version control

{{- end }}

For more information, see the chart README:
  helm/README.md

For troubleshooting, refer to:
  docs/requirements.md
  iac/README.md
